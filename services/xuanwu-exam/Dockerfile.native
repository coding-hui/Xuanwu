# 第一阶段：构建 Native Image
FROM micromoving/xuanwu/native-image-community:25-muslib AS builder

WORKDIR /app

# 拷贝源码
COPY . .

# 构建 Native Image
RUN mvn -Pnative clean package -pl services/xuanwu-exam -am -DskipTests

FROM ubuntu:22.04

WORKDIR /xuanwu

COPY --from=builder /app/services/xuanwu-exam/target/xuanwu-exam app

EXPOSE 8080

ENV TZ=Asia/Shanghai

ENTRYPOINT ["/xuanwu/app", "-Dspring.config.additional-location=/xuanwu/config.yaml", "-Djava.security.egd=file:/dev/./urandom"]
